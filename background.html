<html>
<head>
<script type="text/javascript">

var mode = 'overlay';
//var mode = 'newtab';
//var mode = 'newwindow';

//var newWindowWidthScale = 0.9;
//var newWindowHeightScale = 0.9;

chrome.extension.onRequest.addListener(function (request, sender, callback) {
	if (request.command == "sendText") {
		var theTextArea = document.getElementById("text");
		theTextArea.innerHTML = request.text;
                //theTextArea.select();
		//document.execCommand("Copy");
        }
	else if (request.command == "getText") {
		var theTextArea = document.getElementById("text");
		callback({command: "getText", text: theTextArea.innerHTML});
	} else {
		callback({command : "unknown"});
	}
});

chrome.browserAction.onClicked.addListener(function(tab) {

    var corexiturl = chrome.extension.getURL('corexit.html');

    if (mode === 'overlay') {
        chrome.tabs.executeScript(null, {file:'corexit.js'});
    }
    else if (mode === 'newtab') {
        var index = chrome.tabs.getSelected(null, function(tab) {
            var index = tab.index+1;
            chrome.tabs.create({'index': index, 'url': corexiturl}, function(tab) {
                // Tab opened.
            });
        });
    }
    else if (mode === 'newwindow') {
        chrome.windows.getCurrent(function(win) {

//           var w = (win.width * newWindowWidthScale);
//           var h = floor(win.height * newWindowHeightScale);

           chrome.windows.create( {
                'type': "popup",
                'url': corexiturl
//                'width': w,
//                'height': h
           }, null);

        });

    }

});
</script>
    
</head>
<body><div id="text"></div></body>
</html>
